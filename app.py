import streamlit as st
import pandas as pd
import pickle
import requests
from datetime import datetime, timedelta
import folium
from streamlit_folium import st_folium

# --- 47都道府県マスタデータ ---
PREF_MASTER = {
    1: {"name": "北海道", "jma_id": "016000", "lat": 43.0642, "lon": 141.3469},
    2: {"name": "青森", "jma_id": "020000", "lat": 40.8244, "lon": 140.7400},
    3: {"name": "岩手", "jma_id": "030000", "lat": 39.7036, "lon": 141.1525},
    4: {"name": "宮城", "jma_id": "040000", "lat": 38.2682, "lon": 140.8694},
    5: {"name": "秋田", "jma_id": "050000", "lat": 39.7186, "lon": 140.1024},
    6: {"name": "山形", "jma_id": "060000", "lat": 38.2554, "lon": 140.3396},
    7: {"name": "福島", "jma_id": "070000", "lat": 37.7503, "lon": 140.4675},
    8: {"name": "茨城", "jma_id": "080000", "lat": 36.3418, "lon": 140.4468},
    9: {"name": "栃木", "jma_id": "090000", "lat": 36.5651, "lon": 139.8836},
    10: {"name": "群馬", "jma_id": "100000", "lat": 36.3912, "lon": 139.0608},
    11: {"name": "埼玉", "jma_id": "110000", "lat": 35.8570, "lon": 139.6489},
    12: {"name": "千葉", "jma_id": "120000", "lat": 35.6051, "lon": 140.1233},
    13: {"name": "東京", "jma_id": "130000", "lat": 35.6895, "lon": 139.6917},
    14: {"name": "神奈川", "jma_id": "140000", "lat": 35.4478, "lon": 139.6425},
    15: {"name": "新潟", "jma_id": "150000", "lat": 37.9120, "lon": 139.0489},
    16: {"name": "富山", "jma_id": "160000", "lat": 36.6953, "lon": 137.2113},
    17: {"name": "石川", "jma_id": "170000", "lat": 36.5947, "lon": 136.6256},
    18: {"name": "福井", "jma_id": "180000", "lat": 36.0652, "lon": 136.2216},
    19: {"name": "山梨", "jma_id": "190000", "lat": 35.6639, "lon": 138.5683},
    20: {"name": "長野", "jma_id": "200000", "lat": 36.6485, "lon": 138.1942},
    21: {"name": "岐阜", "jma_id": "210000", "lat": 35.3912, "lon": 136.7223},
    22: {"name": "静岡", "jma_id": "220000", "lat": 34.9769, "lon": 138.3831},
    23: {"name": "愛知", "jma_id": "230000", "lat": 35.1802, "lon": 136.9066},
    24: {"name": "三重", "jma_id": "240000", "lat": 34.7303, "lon": 136.5086},
    25: {"name": "滋賀", "jma_id": "250000", "lat": 35.0045, "lon": 135.8686},
    26: {"name": "京都", "jma_id": "260000", "lat": 35.0212, "lon": 135.7556},
    27: {"name": "大阪", "jma_id": "270000", "lat": 34.6937, "lon": 135.5023},
    28: {"name": "兵庫", "jma_id": "280000", "lat": 34.6913, "lon": 135.1830},
    29: {"name": "奈良", "jma_id": "290000", "lat": 34.6853, "lon": 135.8327},
    30: {"name": "和歌山", "jma_id": "300000", "lat": 34.2260, "lon": 135.1675},
    31: {"name": "鳥取", "jma_id": "310000", "lat": 35.5036, "lon": 134.2383},
    32: {"name": "島根", "jma_id": "320000", "lat": 35.4722, "lon": 133.0506},
    33: {"name": "岡山", "jma_id": "330000", "lat": 34.6618, "lon": 133.9344},
    34: {"name": "広島", "jma_id": "340000", "lat": 34.3963, "lon": 132.4594},
    35: {"name": "山口", "jma_id": "350000", "lat
